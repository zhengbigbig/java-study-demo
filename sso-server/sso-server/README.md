#spring mvc + jsp + tomcat -> sso 单点登录

##前置知识：
- http
- session/cookie 深入理解
- tomcat 基本操作
- sso 基于session的实现 类比cas，适合集群服务

##要点：
###授权服务器
- 授权服务器负责用户的登录，认证等。实现一处登录，处处登录；一处登出，处处登出
- 授权服务器需要提供：
    1. 向用户提供登录
    2. 向客户端提供用户是否在授权服务器上登录，若登录，返回token，反正则跳转登录
    3. 向客户端提供用户携带token的校验，若有效则返回```true```，若无效则返回```false```
    4. 登出，当客户端登出，应向授权服务器发送登出指令，然后清空客户端session
- 授权
###客户端
- 客户端负责用户的资源服务。对用户的权限向授权服务器校验。
    1. 对用户访问进行拦截，拦截后，检查用户在本客户端是否是登录状态
    2. 若不是登录状态，检查用户请求是否携带```token```
    3. 若未携带，则请求授权服务器查看是否在授权服务器登录
    4. 当授权服务器发出登出，则清理客户端session
    5. 客户端请求服务器，只需要带上有效token，无需重复登录
    
##流程：
1. 用户访问客户端A上受限资源，客户端拦截请求，检查用户session是否是登录状态：即```isLogin```为true
2. 若处于登录状态，则通过，允许访问
3. 若未登录，```isLogin```为false，则检查用户当前是否携带```token```
4. 若存在```token```则向授权服务器校验```token```有效性
5. 若校验失败，则向授权服务器询问是否已经登录，若登录则返回```token```,若未登录则跳转登录界面
4. 登录成功则重定向到客户端A，因此过程中redirect_url会反复传递
5. 再次访问客户端A依旧会被拦截，第一次登录成功，校验到```isLogin```依旧还是false，对此次携带的token进行拦截
6. 携带```token``` ```logout_url``` ```jsessionid```向授权服务器校验token有效性，以便授权服务器验证后续访问
7. 校验成功，用户正常访问客户端A上资源，校验失败，则继续呗客户端拦截重复上面步骤
8. 脑栈比较容易溢出的，最好画流程图
9. 注销session分为手动注销和session过期，使用```HttpSessionListener```监听，session销毁时，通知客户端session注销

##总结
1. 实现sso有多种方式，根据业务的需求和场景，应该合理选择。
2. cas认证更适合企业服务集群，而oauth2认证更适合服务商提供给第三方客户端
3. 现如今框架虽好，但是进行了封装和抽象，深入理解其实现，才能更简单上手
